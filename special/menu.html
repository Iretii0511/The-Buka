<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Food Created</title>
</head>
<body>
    




    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function(){
            
        
        $.ajax({
                    url:"http://localhost:3000/food",
                    success:function(result){
                        if(result.length){
                        let output = $("#tb");
                        //console.log(result)
                        result.forEach(food=>{
                            
                            output.append(`<tr>
                                        <td> ${food.id}</td>
                                        <td><img src=${food.imgUrl} style="width:95px;height:100px;border-radius:15px;border:4px solid green"></td>
                                        <td> ${food.name}</td>
                                    <td> ${food.price}</td>
                                    <td> ${food.origin}</td>
                                    <td><button type="button" data-toggle="modal" data-target="#myModal" class="edit btn btn-info" data-id=${food.id}>edit</button></td>
                                    <td><button class="del btn btn-info" data-id=${food.id}>Delete</button></td>
                                    </tr>`);
                                    
                                    
                        })
                        //add delete function to my delete button
                        $('.del').on('click',function(e){
                            //console.log(e.target.dataset.id)
                            //confirm before deleting
                            if(confirm("Sure you want to delete food?")){
                            $.ajax({
                        url:"http://localhost:3000/food/"+e.target.dataset.id,success:function(result){
                            // console.log(result)
                            
                        },
                        method:"DELETE",
                            });
                            }
                            
                        })

                        //lets listen to edit buttton click
                        $('.edit').on('click',function(e){
                            e.preventDefault();
                            let id;
                            let name;
                            let origin;
                            let price;
                            let imgUrl;
                            if(confirm("You are about to edit a food information")){
                            $.ajax({
                        url:"http://localhost:3000/food/"+e.target.dataset.id,
                        success:function(result){
                                console.log(result);
                                
                                if(result){
                                // alert('hi')
                                id=result.id;
                                name=result.name;
                                origin=result.origin;
                                price=result.price;
                                imgUrl=result.imgUrl;

                            //populate modal form with values from database
                            $('#foodId').val(`${id}`);
                            $('#foodName').val(`${name}`);
                            $('#foodOrigin').val(`${origin}`);
                            $('#foodPrice').val(`${price}`);
                            $('#foodImg').val(`${imgUrl}`);
                            }
                        },
                        method:"GET",
                            });
                            }

                        })
                        }
                        
                    },
                    method:"GET"
                });
                //listen to click on update modal form 
                $('.update').on('click',function(e){
                    e.preventDefault();
                // alert("hello!")
                    let id = $('#foodId').val();
                    let name= $('#foodName').val();
                    let origin = $('#foodOrigin').val();
                    let price = $('#foodPrice').val();
                    let imgUrl = $('#foodImg').val();
                    $.ajax({
                url:"http://localhost:3000/food/"+id,success:function(result){
                    console.log(result)
                    },
                method:"PUT",
                data:{
                    id,
                    name,
                    origin,
                    price,
                    imgUrl
                },
            });
                })
            });
    </script>
</body>
</html>